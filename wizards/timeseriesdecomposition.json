{
  "index":2,
  "name":"Time Series Decomposition",
  "status":"beta",
  "parameters":[
    {
      "index":0,
      "type":"fieldselect",
      "tag":"$date",
      "includedateagg":true,
      "includeinfunction":false,
      "scriptid":"date1",
      "name":"Date Field",
      "hint":"Select the date field and the level of granualarity in the source data"
    },
    {
      "index":1,
      "type":"fieldselect",
      "tag":"$numeric",
      "includeagg":true,
      "includeinfunction":true,
      "scriptid":"agg1",
      "name":"Aggregation"
    }
  ],
  "templates":[
    {
      "id":"0",
      "type":"Measure",
      "name":"Trend",
      "description":"The trend component from the timeseries",
      "scriptType":"R",
      "qlikfunction":"R.ScriptEval",
      "rscript":"timeseries <- ts(q$agg1, start=c($(=YEAR(MIN(#!<date1>!#))),$(=NUM(MONTH(MIN(#!<date1>!#))))), frequency=!!<date1>!frequency!, end=c($(=YEAR(MAX(#!<date1>!#))),$(=NUM(MONTH(MAX(#!<date1>!#)))))); decom <- decompose(timeseries); decom$trend;"
    },
    {
      "id":"1",
      "type":"Measure",
      "name":"Seasonal",
      "description":"The seasonal component from the timeseries",
      "scriptType":"R",
      "qlikfunction":"R.ScriptEval",
      "rscript":"timeseries <- ts(q$agg1, start=c($(=YEAR(MIN(#!<date1>!#))),$(=NUM(MONTH(MIN(#!<date1>!#))))), frequency=!!<date1>!frequency!, end=c($(=YEAR(MAX(#!<date1>!#))),$(=NUM(MONTH(MAX(#!<date1>!#)))))); decom <- decompose(timeseries); decom$seasonal;"
    },
    {
      "id":"2",
      "type":"Measure",
      "name":"Random",
      "description":"The random component from the timeseries",
      "scriptType":"R",
      "qlikfunction":"R.ScriptEval",
      "rscript":"timeseries <- ts(q$agg1, start=c($(=YEAR(MIN(#!<date1>!#))),$(=NUM(MONTH(MIN(#!<date1>!#))))), frequency=!!<date1>!frequency!, end=c($(=YEAR(MAX(#!<date1>!#))),$(=NUM(MONTH(MAX(#!<date1>!#)))))); decom <- decompose(timeseries); decom$random;"
    },
    {
      "id":"3",
      "type":"Dimension",
      "name":"Time Series Dimension",
      "description":"The time series dimension",
      "scriptType":"nativedate",
      "idForDate":"date1"
    }
  ],
  "viz":[
    {
      "id":"0",
      "type":"decomline",
      "vizicon":"line-chart",
      "title":"Time Series Decomposition",
      "description":"Time Series Decomposition generated by Advanced Analytics Integration Expression Builder",
      "replacements":[
        {
          "template":"3",
          "path":"qHyperCubeDef.qDimensions[0]",
          "key":"qLibraryId"
        },
        {
          "template":"0",
          "path":"qHyperCubeDef.qMeasures[0]",
          "key":"qLibraryId"
        },
        {
          "template":"1",
          "path":"qHyperCubeDef.qMeasures[1]",
          "key":"qLibraryId"
        },
        {
          "template":"2",
          "path":"qHyperCubeDef.qMeasures[2]",
          "key":"qLibraryId"
        }
      ]
    }
  ]
}
