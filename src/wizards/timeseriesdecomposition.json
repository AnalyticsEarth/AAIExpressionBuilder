{
  "index":1,
  "name":"Time Series Decomposition",
  "status":"live",
  "parameters":[
    {
      "index":0,
      "type":"fieldselect",
      "tag":"$date",
      "includedateagg":true,
      "includeinfunction":true,
      "scriptid":"date1",
      "name":"Date Field",
      "hint":"Select the date field and the level of granualarity in the source data"
    },
    {
      "index":1,
      "type":"fieldselect",
      "tag":"$numeric",
      "includeagg":true,
      "includeinfunction":true,
      "scriptid":"agg1",
      "name":"Aggregation"
    }
  ],
  "templates":[
    {
      "id":"0",
      "type":"Measure",
      "name":"Trend",
      "description":"The trend component from the timeseries",
      "scriptType":"R",
      "qlikfunction":"R.ScriptEval",
      "rscript":"q$rowid <- 1:nrow(q);q2 <- q[order(q$date1),];timeseries <- ts(q2$agg1, start=c($(=YEAR(MIN(#!<date1>!#))),$(=NUM(MONTH(MIN(#!<date1>!#))))), frequency=!!<date1>!frequency!, end=c($(=YEAR(MAX(#!<date1>!#))),$(=NUM(MONTH(MAX(#!<date1>!#))))));t <- as.numeric(stl(timeseries, s.window=\"periodic\")$time.series[,\"trend\"]);t2 <- c(t,rep(NA,length(q2$date1)-length(t)));t3 <- data.frame(rowid=q2$rowid,data=t2);t3[order(t3$rowid),]$data;"
    },
    {
      "id":"1",
      "type":"Measure",
      "name":"Seasonal",
      "description":"The seasonal component from the timeseries",
      "scriptType":"R",
      "qlikfunction":"R.ScriptEval",
      "rscript":"q$rowid <- 1:nrow(q);q2 <- q[order(q$date1),];timeseries <- ts(q2$agg1, start=c($(=YEAR(MIN(#!<date1>!#))),$(=NUM(MONTH(MIN(#!<date1>!#))))), frequency=!!<date1>!frequency!, end=c($(=YEAR(MAX(#!<date1>!#))),$(=NUM(MONTH(MAX(#!<date1>!#))))));t <- as.numeric(stl(timeseries, s.window=\"periodic\")$time.series[,\"seasonal\"]);t2 <- c(t,rep(NA,length(q2$date1)-length(t)));t3 <- data.frame(rowid=q2$rowid,data=t2);t3[order(t3$rowid),]$data;"
    },
    {
      "id":"2",
      "type":"Measure",
      "name":"Random",
      "description":"The random component from the timeseries",
      "scriptType":"R",
      "qlikfunction":"R.ScriptEval",
      "rscript":"q$rowid <- 1:nrow(q);q2 <- q[order(q$date1),];timeseries <- ts(q2$agg1, start=c($(=YEAR(MIN(#!<date1>!#))),$(=NUM(MONTH(MIN(#!<date1>!#))))), frequency=!!<date1>!frequency!, end=c($(=YEAR(MAX(#!<date1>!#))),$(=NUM(MONTH(MAX(#!<date1>!#))))));t <- as.numeric(stl(timeseries, s.window=\"periodic\")$time.series[,\"remainder\"]);t2 <- c(t,rep(NA,length(q2$date1)-length(t)));t3 <- data.frame(rowid=q2$rowid,data=t2);t3[order(t3$rowid),]$data;"
    },
    {
      "id":"3",
      "type":"Dimension",
      "name":"Time Series Dimension",
      "description":"The time series dimension",
      "scriptType":"nativedate",
      "idForDate":"date1"
    }
  ],
  "viz":[
    {
      "id":"0",
      "type":"decomline",
      "vizicon":"line-chart",
      "title":"Time Series Decomposition",
      "description":"Time Series Decomposition generated by Advanced Analytics Integration Expression Builder",
      "replacements":[
        {
          "template":"3",
          "path":"qHyperCubeDef.qDimensions[0]",
          "key":"qLibraryId"
        },
        {
          "template":"0",
          "path":"qHyperCubeDef.qMeasures[0]",
          "key":"qLibraryId"
        },
        {
          "template":"1",
          "path":"qHyperCubeDef.qMeasures[1]",
          "key":"qLibraryId"
        },
        {
          "template":"2",
          "path":"qHyperCubeDef.qMeasures[2]",
          "key":"qLibraryId"
        }
      ]
    }
  ]
}
